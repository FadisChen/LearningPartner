<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPAS AI æ™ºæ…§å­¸ç¿’ä¸­å¿ƒ</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Markmap -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-view"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-lib"></script>

    <!-- Google Generative AI -->
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Shepherd.js for Tour -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/css/shepherd.css" />
    <script src="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/js/shepherd.min.js"></script>

    <style>
        body {
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            height: 100vh;
            overflow: hidden;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Markmap */
        #markmap-container svg {
            width: 100%;
            height: 100%;
        }

        /* Typing Animation */
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        /* Tour Customization */
        .shepherd-element {
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
            border-radius: 12px;
        }

        .shepherd-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e293b;
        }

        .shepherd-text {
            font-size: 0.95rem;
            color: #475569;
        }

        .shepherd-button-primary {
            background: #2563eb !important;
            border-radius: 8px !important;
        }
    </style>
</head>

<body class="flex h-screen text-slate-800">

    <!-- Sidebar -->
    <aside class="w-80 glass flex flex-col border-r border-white/50 z-20 shadow-xl transition-all duration-300"
        id="sidebar">
        <!-- Header -->
        <div class="p-6 border-b border-white/50 flex justify-between items-center">
            <div>
                <h1
                    class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                    AI å­¸ç¿’ä¸­å¿ƒ
                </h1>
                <p class="text-xs text-slate-500 mt-1">iPAS AI æ‡‰ç”¨è¦åŠƒå¸«</p>
            </div>
            <button onclick="app.startTour()" class="text-slate-400 hover:text-blue-500" title="é–‹å•Ÿæ•™å­¸">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                        clip-rule="evenodd" />
                </svg>
            </button>
        </div>

        <!-- Settings: API Key & Model -->
        <div class="px-6 py-4 space-y-4">
            <!-- API Key -->
            <div id="apiKeySection" class="relative">
                <label class="block text-xs font-semibold text-slate-500 mb-2 uppercase tracking-wider">Gemini API
                    Key</label>
                <div class="flex gap-2">
                    <input type="password" id="apiKeyInput" placeholder="è¼¸å…¥ API Key"
                        class="w-full bg-white/50 border border-slate-200 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder:text-slate-400">
                    <button id="saveKeyBtn"
                        class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-3 py-2 transition-colors shadow-lg shadow-blue-500/30">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <p id="keyStatus" class="text-[10px] text-slate-400 mt-1 pl-1">Key å„²å­˜æ–¼ç€è¦½å™¨æœ¬åœ°ç«¯</p>
            </div>

            <!-- Model Selector -->
            <div id="modelSection" class="relative">
                <label class="block text-xs font-semibold text-slate-500 mb-2 uppercase tracking-wider">ä½¿ç”¨æ¨¡å‹
                    (Model ID)</label>
                <input type="text" id="modelInput" value="gemini-2.5-flash" placeholder="ä¾‹å¦‚: gemini-2.5-flash"
                    class="w-full bg-white/50 border border-slate-200 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500/50 transition-all font-mono text-slate-600">
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto px-4 space-y-2 py-2" id="subjectNav">
            <div class="space-y-1">
                <label
                    class="block text-xs font-semibold text-slate-500 mb-2 px-2 uppercase tracking-wider">é¸æ“‡ç§‘ç›®</label>

                <button onclick="app.switchSubject('subject1')" id="nav-subject1"
                    class="w-full text-left px-4 py-3 rounded-xl transition-all duration-200 flex items-center gap-3 group bg-white/40 hover:bg-white/80 border border-transparent hover:border-blue-200 shadow-sm">
                    <div
                        class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center group-hover:scale-110 transition-transform font-bold">
                        1</div>
                    <div>
                        <div class="font-semibold text-sm">æ‡‰ç”¨è¦åŠƒ</div>
                        <div class="text-[10px] text-slate-500">äººå·¥æ™ºæ…§æŠ€è¡“</div>
                    </div>
                </button>

                <button onclick="app.switchSubject('subject2')" id="nav-subject2"
                    class="w-full text-left px-4 py-3 rounded-xl transition-all duration-200 flex items-center gap-3 group hover:bg-white/80 border border-transparent hover:border-green-200">
                    <div
                        class="w-8 h-8 rounded-lg bg-green-100 text-green-600 flex items-center justify-center group-hover:scale-110 transition-transform font-bold">
                        2</div>
                    <div>
                        <div class="font-semibold text-sm">å¤§æ•¸æ“šåˆ†æ</div>
                        <div class="text-[10px] text-slate-500">è™•ç†èˆ‡æ‡‰ç”¨</div>
                    </div>
                </button>

                <button onclick="app.switchSubject('subject3')" id="nav-subject3"
                    class="w-full text-left px-4 py-3 rounded-xl transition-all duration-200 flex items-center gap-3 group hover:bg-white/80 border border-transparent hover:border-purple-200">
                    <div
                        class="w-8 h-8 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center group-hover:scale-110 transition-transform font-bold">
                        3</div>
                    <div>
                        <div class="font-semibold text-sm">æ©Ÿå™¨å­¸ç¿’</div>
                        <div class="text-[10px] text-slate-500">æŠ€è¡“èˆ‡æ‡‰ç”¨</div>
                    </div>
                </button>
            </div>

            <!-- File Upload Area for Current Subject -->
            <div class="mt-8 px-2" id="uploadSection">
                <label class="block text-xs font-semibold text-slate-500 mb-2 uppercase tracking-wider">å­¸ç¿’æŒ‡å¼•
                    (Context)</label>
                <div class="relative group">
                    <input type="file" id="pdfUploader" accept="application/pdf"
                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" disabled>
                    <div
                        class="bg-white/40 border-2 border-dashed border-slate-300 rounded-xl p-4 text-center transition-all group-hover:border-blue-400 group-hover:bg-white/60">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-6 w-6 mx-auto text-slate-400 mb-2 group-hover:text-blue-500" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p class="text-xs text-slate-600 font-medium" id="uploadText">é¸æ“‡ PDF æª”æ¡ˆ</p>
                        <p class="text-[10px] text-slate-400 mt-1">æä¾› AI åƒè€ƒæ–‡ä»¶</p>
                    </div>
                </div>
                <div id="fileStatus"
                    class="mt-2 text-[10px] text-emerald-600 font-medium hidden flex items-center gap-1">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>æª”æ¡ˆå·²è¼‰å…¥</span>
                </div>
            </div>
        </nav>

        <!-- Footer -->
        <div class="p-4 border-t border-white/50 text-center">
            <p class="text-[10px] text-slate-400">Powered by Google Gemini</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col relative overflow-hidden">
        <!-- Floating Header / Tabs -->
        <div class="absolute top-4 left-4 right-4 z-10 flex justify-between items-start pointer-events-none">
            <div class="glass rounded-xl p-1 flex gap-1 pointer-events-auto shadow-lg" id="tabContainer">
                <button onclick="app.switchTab('map')" id="tab-map"
                    class="px-4 py-2 rounded-lg text-sm font-medium bg-blue-100 text-blue-700 shadow-sm transition-all">
                    çŸ¥è­˜æ¶æ§‹åœ–
                </button>
                <button onclick="app.switchTab('chat')" id="tab-chat"
                    class="px-4 py-2 rounded-lg text-sm font-medium hover:bg-white/50 text-slate-600 transition-all flex gap-2 items-center">
                    <span>AI å°å¸«</span>
                    <span class="bg-blue-600 text-white text-[10px] px-1.5 py-0.5 rounded-full hidden"
                        id="chatBadge">æ–°è¨Šæ¯</span>
                </button>
            </div>
        </div>

        <!-- View: Knowledge Map -->
        <div id="view-map" class="flex-1 w-full h-full bg-white/30 backdrop-blur-sm transition-opacity duration-300">
            <div class="w-full h-full" id="markmap-container">
                <svg id="markmap" class="w-full h-full"></svg>
            </div>
            <!-- Floating Node Action Context Menu (Hidden by default) -->
            <div id="nodeContextMenu"
                class="absolute hidden glass rounded-lg shadow-xl p-2 z-50 min-w-[150px] transform transition-all scale-95 opacity-0">
                <div class="text-xs font-bold text-slate-500 px-2 py-1 border-b border-slate-200 mb-1"
                    id="selectedNodeTitle">Topic</div>
                <button onclick="app.askAI('explain')"
                    class="w-full text-left px-2 py-1.5 text-sm hover:bg-blue-50 text-slate-700 rounded flex gap-2 items-center">
                    <span>ğŸ’¡</span> è§£é‡‹é€™å€‹æ¦‚å¿µ
                </button>
                <button onclick="app.askAI('quiz')"
                    class="w-full text-left px-2 py-1.5 text-sm hover:bg-green-50 text-slate-700 rounded flex gap-2 items-center">
                    <span>â“</span> å‡ºä¸€é¡Œè€ƒæˆ‘
                </button>
            </div>
        </div>

        <!-- View: AI Chat -->
        <div id="view-chat" class="hidden flex-1 w-full h-full bg-white/50 flex flex-col pt-16">
            <!-- Chat Messages -->
            <div id="chatHistory" class="flex-1 overflow-y-auto px-10 py-4 space-y-6">
                <!-- Welcome Message -->
                <div class="flex gap-4">
                    <div
                        class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex-shrink-0 flex items-center justify-center text-white font-bold text-xs">
                        AI</div>
                    <div
                        class="max-w-2xl bg-white rounded-2xl rounded-tl-none p-4 shadow-sm text-sm leading-relaxed text-slate-700 border border-slate-100">
                        ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI å°å¸«ã€‚æ­¡è¿ä¸Šå‚³å­¸ç¿’æŒ‡å¼• PDFï¼Œæˆ–æ˜¯åœ¨çŸ¥è­˜æ¶æ§‹åœ–ä¸­é»æ“Šä»»ä½•ä¸»é¡Œï¼Œè®“æˆ‘ç‚ºä½ è§£èªªï¼
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-6">
                <div class="max-w-3xl mx-auto relative glass rounded-2xl shadow-xl p-2 flex gap-2 items-end">
                    <textarea id="chatInput" rows="1" placeholder="å•é»ä»€éº¼..."
                        class="flex-1 bg-transparent border-none focus:ring-0 text-slate-700 placeholder:text-slate-400 resize-none py-3 px-3 max-h-32 text-sm"></textarea>

                    <button onclick="app.sendMessage()" id="sendBtn"
                        class="p-2 mb-1 bg-blue-600 hover:bg-blue-700 text-white rounded-xl shadow-lg shadow-blue-500/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                        </svg>
                    </button>
                </div>
                <p class="text-center text-[10px] text-slate-400 mt-2">AI æ¨¡å‹å¯èƒ½æœƒçŠ¯éŒ¯ï¼Œè«‹ä»¥å®˜æ–¹æ•™æç‚ºæº–ã€‚</p>
            </div>
        </div>
    </main>

    <!-- App Logic -->
    <script>
        // DATA
        const SUBJECTS = {
            subject1: {
                title: "ç§‘ç›®1ï¼šæ‡‰ç”¨è¦åŠƒ",
                color: "blue",
                markdown: `# ç§‘ç›®1: äººå·¥æ™ºæ…§æŠ€è¡“æ‡‰ç”¨è¦åŠƒ

## 1. AI åŸºç¤èªçŸ¥
- **äººå·¥æ™ºæ…§å®šç¾©**: æ¨¡æ“¬äººé¡æ™ºæ…§çš„é›»è…¦ç³»çµ±
- **ç™¼å±•æ­·ç¨‹**: 
  - è¦å‰‡å¼ AI -> æ©Ÿå™¨å­¸ç¿’ -> æ·±åº¦å­¸ç¿’
- **å¼·/å¼± AI**:
  - Weak AI: å°ˆæ³¨å–®ä¸€ä»»å‹™ (å¦‚ AlphaGo)
  - Strong AI: å…·å‚™äººé¡èˆ¬é€šç”¨æ™ºæ…§ (å°šæœªå¯¦ç¾)
- **ç”Ÿæˆå¼ AI (GenAI)**: LLM, Diffusion Models

## 2. AI å°ˆæ¡ˆè¦åŠƒæµç¨‹
- **éœ€æ±‚è¨ªè«‡èˆ‡å•é¡Œå®šç¾©**:
  - äº†è§£ç—›é» (Pain Points)
  - SMART åŸå‰‡è¨­å®šç›®æ¨™
- **å¯è¡Œæ€§è©•ä¼° (Feasibility)**:
  - æŠ€è¡“å¯è¡Œæ€§
  - æ•¸æ“šå¯ç”¨æ€§
  - ç¶“æ¿Ÿæ•ˆç›Š (ROI)
- **å°ˆæ¡ˆéšæ®µ**:
  - POC (æ¦‚å¿µé©—è­‰)
  - Pilot (è©¦é»)
  - Production (æ­£å¼ä¸Šç·š)

## 3. æ³•å¾‹ã€å€«ç†èˆ‡é¢¨éšª
- **éš±ç§ä¿è­·**:
  - å»è­˜åˆ¥åŒ– (De-identification)
  - æ­ç›Ÿ GDPR / å°ç£å€‹è³‡æ³•
- **AI å€«ç†**:
  - å…¬å¹³æ€§ (Fairness): é¿å…æ¼”ç®—æ³•åè¦‹
  - å¯è§£é‡‹æ€§ (Explainability/XAI)
  - é€æ˜åº¦
- **è³‡å®‰é¢¨éšª**: å°æŠ—å¼æ”»æ“Š (Adversarial Attacks)

## 4. é ˜åŸŸæ‡‰ç”¨æ¡ˆä¾‹
- **æ™ºæ…§è£½é€ **: é é˜²æ€§ç¶­è­· (PdM), ç‘•ç–µæª¢æ¸¬ (AOI)
- **æ™ºæ…§é‡‘è**: ä¿¡ç”¨è©•åˆ†, è©æ¬ºåµæ¸¬, æ™ºèƒ½å®¢æœ
- **æ™ºæ…§é†«ç™‚**: é†«å­¸å½±åƒåˆ†æ, è—¥ç‰©é–‹ç™¼
- **æ™ºæ…§é›¶å”®**: æ¨è–¦ç³»çµ±, éœ€æ±‚é æ¸¬`
            },
            subject2: {
                title: "ç§‘ç›®2ï¼šå¤§æ•¸æ“šåˆ†æ",
                color: "green",
                markdown: `# ç§‘ç›®2: å¤§æ•¸æ“šè™•ç†åˆ†æèˆ‡æ‡‰ç”¨

## 1. è³‡æ–™å·¥ç¨‹æ¶æ§‹
- **è³‡æ–™é¡å‹**:
  - çµæ§‹åŒ– (Structured): è¡¨æ ¼, SQL
  - åŠçµæ§‹åŒ– (Semi-structured): JSON, XML, Log
  - éçµæ§‹åŒ– (Unstructured): æ–‡å­—, å½±åƒ, éŸ³è¨Š
- **å¤§æ•¸æ“šç‰¹å¾µ (5V)**:
  - Volume (é‡), Velocity (é€Ÿ), Variety (æ¨£), Veracity (çœŸ), Value (å€¼)
- **è³‡æ–™å„²å­˜**:
  - é—œè¯å¼è³‡æ–™åº« (RDBMS)
  - NoSQL (MongoDB, Cassandra)
  - Data Warehouse (å€‰å„²) vs Data Lake (æ¹–)

## 2. è³‡æ–™å‰è™•ç† (Data Preprocessing)
- **è³‡æ–™æ¸…æ´— (Cleaning)**:
  - ç¼ºå¤±å€¼ (Missing Data): åˆªé™¤ã€å¹³å‡è£œå€¼ã€æ’å€¼
  - é›¢ç¾¤å€¼ (Outliers): ç›’é¬šåœ–åµæ¸¬ã€Z-Score
- **è³‡æ–™è½‰æ›**:
  - æ­£è¦åŒ– (Normalization): 0-1 scaling
  - æ¨™æº–åŒ– (Standardization): Z-score scaling
  - One-Hot Encoding (ç¨ç†±ç·¨ç¢¼)

## 3. æ¢ç´¢å¼è³‡æ–™åˆ†æ (EDA)
- **çµ±è¨ˆæŒ‡æ¨™**:
  - é›†ä¸­è¶¨å‹¢: å¹³å‡æ•¸, ä¸­ä½æ•¸, çœ¾æ•¸
  - é›¢æ•£ç¨‹åº¦: æ¨™æº–å·®, è®Šç•°æ•¸, å››åˆ†ä½è· (IQR)
- **é—œè¯åˆ†æ**: Pearson ç›¸é—œä¿‚æ•¸ (-1 ~ 1)

## 4. è³‡æ–™è¦–è¦ºåŒ– (Visualization)
- **æ¯”è¼ƒ**: é•·æ¢åœ– (Bar Chart)
- **åˆ†ä½ˆ**: ç›´æ–¹åœ– (Histogram), ç›’é¬šåœ– (Box Plot)
- **é—œè¯**: æ•£ä½ˆåœ– (Scatter Plot)
- **çµ„æˆ**: åœ“é¤…åœ– (Pie Chart)
- **å·¥å…·**: Matplotlib, Seaborn, Tableau, PowerBI`
            },
            subject3: {
                title: "ç§‘ç›®3ï¼šæ©Ÿå™¨å­¸ç¿’",
                color: "purple",
                markdown: `# ç§‘ç›®3: æ©Ÿå™¨å­¸ç¿’æŠ€è¡“èˆ‡æ‡‰ç”¨

## 1. æ©Ÿå™¨å­¸ç¿’æµç¨‹ (ML Pipeline)
- **è³‡æ–™æ”¶é›†èˆ‡æ¨™è¨»**: Labeling
- **ç‰¹å¾µå·¥ç¨‹**: Feature Selection, Dimensionality Reduction
- **æ¨¡å‹è¨“ç·´**: Training / Validation
- **æ¨¡å‹æ¸¬è©¦èˆ‡éƒ¨ç½²**: Testing / Deployment

## 2. å­¸ç¿’æ¼”ç®—æ³•åˆ†é¡
- **ç›£ç£å¼å­¸ç¿’ (Supervised)**:
  - *è¿´æ­¸ (Regression)*: é æ¸¬é€£çºŒæ•¸å€¼ (æˆ¿åƒ¹, æº«åº¦)
    - Linear Regression
  - *åˆ†é¡ (Classification)*: é æ¸¬é¡åˆ¥ (è²“/ç‹—, åƒåœ¾éƒµä»¶)
    - Decision Tree, Random Forest
    - SVM (æ”¯æ´å‘é‡æ©Ÿ)
    - Logistic Regression
- **éç›£ç£å¼å­¸ç¿’ (Unsupervised)**:
  - *åˆ†ç¾¤ (Clustering)*: K-Means, DBSCAN
  - *é™ç¶­ (Dimensionality Reduction)*: PCA (ä¸»æˆåˆ†åˆ†æ)
- **å¼·åŒ–å­¸ç¿’ (Reinforcement)**: Agent, Environment, Reward

## 3. æ·±åº¦å­¸ç¿’ (Deep Learning)
- **åŸºç¤æ¶æ§‹**: Perceptron, MLP (å¤šå±¤æ„ŸçŸ¥æ©Ÿ)
- **CNN (å·ç©ç¥ç¶“ç¶²è·¯)**:
  - æ‡‰ç”¨: å½±åƒè¾¨è­˜ (Image Recognition)
  - çµæ§‹: Convolution Layer, Pooling Layer
- **RNN (å¾ªç’°ç¥ç¶“ç¶²è·¯)**:
  - æ‡‰ç”¨: è‡ªç„¶èªè¨€è™•ç† (NLP), æ™‚é–“åºåˆ—
  - è®Šé«”: LSTM, GRU
- **Transformer**: Attention Mechanism, BERT, GPT

## 4. æ¨¡å‹è©•ä¼°æŒ‡æ¨™
- **åˆ†é¡æŒ‡æ¨™**:
  - æ··æ·†çŸ©é™£ (Confusion Matrix): TP, TN, FP, FN
  - Accuracy (æº–ç¢ºç‡)
  - Precision (ç²¾ç¢ºç‡) vs Recall (å¬å›ç‡)
  - F1-Score (èª¿å’Œå¹³å‡)
  - ROC Curve / AUC
- **è¿´æ­¸æŒ‡æ¨™**:
  - MSE (å‡æ–¹èª¤å·®)
  - RMSE
  - MAE (å¹³å‡çµ•å°èª¤å·®)
- **å¸¸è¦‹å•é¡Œ**:
  - Overfitting (éåº¦æ“¬åˆ): è¨“ç·´å¥½ä½†æ¸¬è©¦å·® -> Regularization, Dropout
  - Underfitting (ä½åº¦æ“¬åˆ): æ¨¡å‹å¤ªç°¡å–® -> å¢åŠ ç‰¹å¾µ, åŠ æ·±æ¨¡å‹`
            }
        };

        // CORE APP
        const app = {
            currentSubject: 'subject1',
            currentTab: 'map',
            apiKey: localStorage.getItem('gemini_key') || '',
            mm: null,
            selectedNode: null,
            fileData: null,

            init() {
                // UI Init
                this.updateAuthUI();
                this.switchSubject('subject1');

                // Load Model Preference
                const savedModel = localStorage.getItem('gemini_model') || 'gemini-2.5-flash';
                const modelInput = document.getElementById('modelInput');
                modelInput.value = savedModel;

                // Listeners
                document.getElementById('saveKeyBtn').addEventListener('click', () => this.saveKey());
                document.getElementById('apiKeyInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.saveKey();
                });

                document.getElementById('pdfUploader').addEventListener('change', (e) => {
                    this.handleFileUpload(e.target.files[0]);
                });

                document.getElementById('modelInput').addEventListener('change', (e) => {
                    localStorage.setItem('gemini_model', e.target.value.trim());
                });

                const chatInput = document.getElementById('chatInput');
                chatInput.addEventListener('input', function () {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                document.addEventListener('click', (e) => {
                    const menu = document.getElementById('nodeContextMenu');
                    if (!menu.contains(e.target) && !e.target.closest('.markmap-node')) {
                        this.hideContextMenu();
                    }
                });

                // Auto Start Tour if no key
                setTimeout(() => {
                    if (!this.apiKey) {
                        this.startTour();
                    }
                }, 1000);
            },

            startTour() {
                if (this.tour) this.tour.complete();

                this.tour = new Shepherd.Tour({
                    useModalOverlay: true,
                    defaultStepOptions: {
                        classes: 'shadow-md bg-purple-dark',
                        scrollTo: true
                    }
                });

                this.tour.addStep({
                    id: 'intro',
                    text: 'æ­¡è¿ä½¿ç”¨ AI æ™ºæ…§å­¸ç¿’ä¸­å¿ƒï¼è®“æˆ‘å¸¶ä½ å¿«é€Ÿå°è¦½ã€‚',
                    attachTo: { element: '#sidebar', on: 'right' },
                    buttons: [{ text: 'ä¸‹ä¸€æ­¥', action: () => this.tour.next() }]
                });

                this.tour.addStep({
                    id: 'api-key',
                    text: 'é¦–å…ˆï¼Œåœ¨é€™è£¡è¼¸å…¥ä½ çš„ Gemini API Keyã€‚é€™æ˜¯ä½¿ç”¨ AI åŠŸèƒ½çš„å¿…è¦æ¢ä»¶ã€‚<br><a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-500 underline">å–å¾— API Key</a>',
                    attachTo: { element: '#apiKeySection', on: 'right' },
                    buttons: [{ text: 'ä¸Šä¸€æ­¥', action: () => this.tour.back() }, { text: 'ä¸‹ä¸€æ­¥', action: () => this.tour.next() }]
                });

                this.tour.addStep({
                    id: 'subjects',
                    text: 'åˆ‡æ›ä¸åŒçš„è€ƒç§‘ï¼Œå³å´çš„çŸ¥è­˜åœ°åœ–æœƒéš¨ä¹‹æ›´æ–°ã€‚',
                    attachTo: { element: '#subjectNav', on: 'right' },
                    buttons: [{ text: 'ä¸Šä¸€æ­¥', action: () => this.tour.back() }, { text: 'ä¸‹ä¸€æ­¥', action: () => this.tour.next() }]
                });

                this.tour.addStep({
                    id: 'upload',
                    text: 'æœ€é‡è¦çš„æ­¥é©Ÿï¼š<b>ä¸Šå‚³è©²ç§‘ç›®çš„ PDF å­¸ç¿’æŒ‡å¼•</b>ã€‚AI æœƒè®€å–å…§å®¹ä¸¦æ ¹æ“šæ–‡ä»¶å›ç­”ä½ çš„å•é¡Œã€‚',
                    attachTo: { element: '#uploadSection', on: 'right' },
                    buttons: [{ text: 'ä¸Šä¸€æ­¥', action: () => this.tour.back() }, { text: 'ä¸‹ä¸€æ­¥', action: () => this.tour.next() }]
                });

                this.tour.addStep({
                    id: 'map',
                    text: 'è©¦è‘—é»æ“Šåœ°åœ–ä¸Šçš„<b>ä»»ä½•æ–‡å­—ç¯€é»</b>ï¼Œå¯ä»¥å« AI ç›´æ¥è§£é‡‹è©²æ¦‚å¿µæˆ–å‡ºé¡Œè€ƒä½ ï¼',
                    attachTo: { element: '#markmap-container', on: 'left' },
                    buttons: [{ text: 'äº†è§£äº†ï¼Œé–‹å§‹å­¸ç¿’ï¼', action: () => this.tour.complete() }]
                });

                this.tour.start();
            },

            saveKey() {
                const input = document.getElementById('apiKeyInput');
                if (input.value.trim().length > 10) {
                    this.apiKey = input.value.trim();
                    localStorage.setItem('gemini_key', this.apiKey);
                    this.updateAuthUI();
                } else {
                    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ API Key');
                }
            },

            updateAuthUI() {
                const input = document.getElementById('apiKeyInput');
                const status = document.getElementById('keyStatus');
                const uploader = document.getElementById('pdfUploader');

                if (this.apiKey) {
                    input.value = '';
                    input.placeholder = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢ (å·²å„²å­˜)';
                    status.textContent = 'API Key å·²å°±ç·’ âœ…';
                    status.className = 'text-[10px] text-green-500 mt-1 pl-1';
                    uploader.disabled = false;
                    document.getElementById('uploadText').textContent = 'é»æ“Šä¸Šå‚³ PDF';
                } else {
                    uploader.disabled = true;
                    document.getElementById('uploadText').textContent = 'è«‹å…ˆè¨­å®š API Key';
                }
            },

            switchSubject(id) {
                this.currentSubject = id;
                document.querySelectorAll('nav button').forEach(btn => {
                    btn.classList.remove('bg-blue-50', 'bg-green-50', 'bg-purple-50', 'border-blue-200', 'border-green-200', 'border-purple-200', 'shadow-sm');
                });
                const activeBtn = document.getElementById(`nav-${id}`);
                const color = SUBJECTS[id].color;
                activeBtn.classList.add(`bg-${color}-50`, `border-${color}-200`, 'shadow-sm');

                this.renderMap(SUBJECTS[id].markdown);
                this.fileData = null;
                document.getElementById('fileStatus').classList.add('hidden');
            },

            switchTab(tab) {
                this.currentTab = tab;
                document.getElementById('view-map').classList.toggle('hidden', tab !== 'map');
                document.getElementById('view-chat').classList.toggle('hidden', tab !== 'chat');

                const btnMap = document.getElementById('tab-map');
                const btnChat = document.getElementById('tab-chat');

                if (tab === 'map') {
                    btnMap.classList.add('bg-blue-100', 'text-blue-700', 'shadow-sm');
                    btnMap.classList.remove('text-slate-600', 'hover:bg-white/50');
                    btnChat.classList.remove('bg-blue-100', 'text-blue-700', 'shadow-sm');
                    btnChat.classList.add('text-slate-600', 'hover:bg-white/50');
                } else {
                    btnChat.classList.add('bg-blue-100', 'text-blue-700', 'shadow-sm');
                    btnChat.classList.remove('text-slate-600', 'hover:bg-white/50');
                    btnMap.classList.remove('bg-blue-100', 'text-blue-700', 'shadow-sm');
                    btnMap.classList.add('text-slate-600', 'hover:bg-white/50');
                    document.getElementById('chatBadge').classList.add('hidden');
                }
            },

            renderMap(markdown) {
                const { Markmap, Transformer } = window.markmap;
                const transformer = new Transformer();
                const { root } = transformer.transform(markdown);

                if (this.mm) {
                    this.mm.setData(root);
                    this.mm.fit();
                } else {
                    this.mm = Markmap.create('#markmap', {
                        embedGlobalCSS: true, scrollForPan: true, zoom: true,
                    }, root);
                }

                setTimeout(() => {
                    const nodes = document.querySelectorAll('.markmap-node');
                    nodes.forEach(node => {
                        node.style.cursor = 'pointer';
                        node.onclick = (e) => {
                            e.stopPropagation();
                            const text = node.textContent;
                            this.showContextMenu(e.pageX, e.pageY, text);
                        };
                    });
                }, 500);
            },

            showContextMenu(x, y, text) {
                this.selectedNode = text;
                const menu = document.getElementById('nodeContextMenu');
                document.getElementById('selectedNodeTitle').textContent = text.substring(0, 20) + (text.length > 20 ? '...' : '');
                menu.classList.remove('hidden');
                requestAnimationFrame(() => {
                    menu.classList.remove('scale-95', 'opacity-0');
                    menu.classList.add('scale-100', 'opacity-100');
                    menu.style.left = x + 'px';
                    menu.style.top = y + 'px';
                });
            },

            hideContextMenu() {
                const menu = document.getElementById('nodeContextMenu');
                menu.classList.add('scale-95', 'opacity-0');
                menu.classList.remove('scale-100', 'opacity-100');
                setTimeout(() => menu.classList.add('hidden'), 200);
            },

            async handleFileUpload(file) {
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64Data = e.target.result.split(',')[1];
                    this.fileData = {
                        inlineData: {
                            data: base64Data,
                            mimeType: file.type // "application/pdf"
                        }
                    };
                    document.getElementById('fileStatus').classList.remove('hidden');
                    document.getElementById('uploadText').textContent = file.name;
                    this.addChatMessage('system', `æª”æ¡ˆ ${file.name} å·²è¼‰å…¥ï¼Œæ‚¨å¯ä»¥é–‹å§‹é‡å°å…§å®¹æå•ï¼`);
                    this.switchTab('chat');
                };
                reader.readAsDataURL(file);
            },

            async sendMessage() {
                const input = document.getElementById('chatInput');
                const text = input.value.trim();
                if (!text) return;
                if (!this.apiKey) {
                    alert('è«‹å…ˆè¨­å®š API Key');
                    this.startTour();
                    return;
                }
                input.value = '';
                input.style.height = 'auto';

                this.addChatMessage('user', text);

                // Create AI bubble placeholder
                const aiBubbleId = 'ai-response-' + Date.now();
                this.addChatMessage('ai', '<span class="animate-pulse">...</span>', aiBubbleId);

                try {
                    await this.streamGemini(text, aiBubbleId);
                } catch (err) {
                    const bubble = document.getElementById(aiBubbleId); // Find the bubble content div
                    if (bubble) bubble.innerHTML += `<br><span class="text-red-500 text-xs">éŒ¯èª¤: ${err.message}</span>`;
                }
            },

            async askAI(mode) {
                this.hideContextMenu();
                this.switchTab('chat');
                let prompt = '';
                if (mode === 'explain') {
                    prompt = `è«‹è§£é‡‹ã€Œ${this.selectedNode}ã€é€™å€‹æ¦‚å¿µï¼Œç‰¹åˆ¥æ˜¯åœ¨ ${SUBJECTS[this.currentSubject].title} çš„é ˜åŸŸä¸­ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œç°¡å–®æ˜“æ‡‚ã€‚`;
                } else if (mode === 'quiz') {
                    prompt = `é‡å°ã€Œ${this.selectedNode}ã€é€™ä¸»é¡Œï¼Œè«‹å‡ºä¸€é¡Œå–®é¸é¡Œè€ƒæˆ‘ï¼Œä¸¦é™„ä¸Šç­”æ¡ˆè§£æã€‚ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚`;
                }

                this.addChatMessage('user', prompt);
                const aiBubbleId = 'ai-response-' + Date.now();
                this.addChatMessage('ai', '<span class="animate-pulse">...</span>', aiBubbleId);

                try {
                    await this.streamGemini(prompt, aiBubbleId);
                } catch (err) {
                    const bubble = document.getElementById(aiBubbleId);
                    if (bubble) bubble.innerHTML += `<br><span class="text-red-500 text-xs">éŒ¯èª¤: ${err.message}</span>`;
                }
            },

            async streamGemini(promptText, elementId) {
                const { GoogleGenerativeAI } = document.querySelector('script[type="importmap"]').textContent
                    ? { GoogleGenerativeAI: (await import('https://esm.run/@google/generative-ai')).GoogleGenerativeAI }
                    : window;

                const genAI = new GoogleGenerativeAI(this.apiKey);
                const modelInput = document.getElementById('modelInput');
                let modelName = modelInput.value.trim() || 'gemini-2.5-flash';

                // Disable "Thinking" if supported by the API (though mostly handled by model selection)
                // We use standard generation config, not requesting thinking config
                const model = genAI.getGenerativeModel({
                    model: modelName,
                    generationConfig: {
                        // thinking_config: { include_thoughts: false } // Hypothetical param if user meant API level
                    }
                });

                const parts = [];
                if (this.fileData) parts.push(this.fileData);
                parts.push({ text: promptText });

                const result = await model.generateContentStream(parts);

                let fullText = '';
                const bubbleContent = document.getElementById(elementId);

                for await (const chunk of result.stream) {
                    const chunkText = chunk.text();
                    fullText += chunkText;
                    // Render Markdown incrementally (simple approach: re-render full text)
                    if (bubbleContent) bubbleContent.innerHTML = window.marked.parse(fullText);

                    // Auto-scroll
                    const history = document.getElementById('chatHistory');
                    history.scrollTop = history.scrollHeight;
                }
            },

            addChatMessage(role, text, elementId = null) {
                const history = document.getElementById('chatHistory');
                const div = document.createElement('div');
                div.className = 'flex gap-4 ' + (role === 'user' ? 'flex-row-reverse' : '');

                const avatar = document.createElement('div');
                avatar.className = `w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center text-white font-bold text-xs ${role === 'user' ? 'bg-slate-500' : (role === 'system' ? 'bg-red-400' : 'bg-gradient-to-tr from-blue-500 to-purple-500')}`;
                avatar.textContent = role === 'user' ? 'U' : (role === 'system' ? '!' : 'AI');

                const bubble = document.createElement('div');
                bubble.className = `max-w-2xl rounded-2xl p-4 shadow-sm text-sm leading-relaxed border ${role === 'user' ? 'bg-blue-600 text-white rounded-tr-none border-blue-600' : 'bg-white rounded-tl-none text-slate-700 border-slate-100'}`;

                if (elementId) bubble.id = elementId;

                if (role === 'user') { bubble.textContent = text; }
                else { bubble.innerHTML = window.marked.parse(text); }
                div.appendChild(avatar);
                div.appendChild(bubble);
                history.appendChild(div);
                history.scrollTop = history.scrollHeight;
            },

            showTypingIndicator() {
                const history = document.getElementById('chatHistory');
                const div = document.createElement('div');
                div.id = 'typingIndicator';
                div.className = 'flex gap-4';
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex-shrink-0 flex items-center justify-center text-white font-bold text-xs">AI</div>
                    <div class="bg-white rounded-2xl rounded-tl-none p-4 shadow-sm border border-slate-100 flex items-center gap-1">
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                    </div>`;
                history.appendChild(div);
                history.scrollTop = history.scrollHeight;
            },

            removeTypingIndicator() {
                const el = document.getElementById('typingIndicator');
                if (el) el.remove();
            }
        };
        window.onload = () => app.init();
    </script>
</body>

</html>